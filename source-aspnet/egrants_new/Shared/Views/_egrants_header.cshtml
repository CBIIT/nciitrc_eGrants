@{
    Layout = null;

    var sessionTimeout = HttpContext.Current.Session.Timeout;
    var milliseconds = sessionTimeout * 60 * 1000;

}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <meta name="viewport" content="width=device-width"/>
    <title></title>

    <link href="~/Content/egrants.css" rel="stylesheet" type="text/css"/>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" type="text/css"/>

    <script src="~/scripts/jquery-3.6.4.min.js"></script>
    <script src="~/scripts/bootstrap.min.js"></script>
    <script src="~/scripts/validation.js"></script>
    @*<script src="~/scripts/session-timeout.js"></script>*@
    <script src="~/scripts/sessionTimeout.js"></script>

    <script>
        var user_position_id = @Convert.ToInt16(Session["position_id"]);
        var QuickLinkType = [];

        var countDownDate = @milliseconds;


        var remainingSeconds = @milliseconds / 1000;
        var counter = 60;

        function displayHello() {
            $(".sessionTimeout").text(@HttpContext.Current.Session.Timeout);
        }

        $(document).ready(function () {
//            sessionTimeout({
//                warnAfter: 5000, //900000, // 15 min
//                timeOutAfter: 10000, //1200000, // 20 min
//                message: 'Warning: You will be logged off in 15:00' ,
//                keepAliveUrl: 'KeepAlive',
//              //  stayConnectedBtnText: 'Stay Connected',
//              //  logOutUrl: null,
//              //  timeOutUrl: 'SignOut',
//                appendTimestamp: true
//            });



            setInterval(function() {
                counter--;
                if (counter >= 0) {
                    $('.count').text(counter);
                    //span = document.getElementById("count");
                    //span.innerHTML = counter;
                }    
                if (counter === 0) {      
                    clearInterval(counter);
                }

            }, 1000);


            //check Session["position_id"]
            if (user_position_id >= 2) {
                QuickLink = document.getElementById("leftpanelS");
            } else {
                QuickLink = document.getElementById("leftpanelP");
            }

            //set
            if (user_position_id >= 1) {
                if (sessionStorage.getItem("QuickLinks") == null) {
                    sessionStorage.setItem("QuickLinks", "1");
                }

                //get
                if (sessionStorage.getItem("QuickLinks") == "1") {
                    QuickLink.style.display = "block";
                } else QuickLink.style.display = "none";
            }
        });

        function toggleleftpanel() {
            if (QuickLink.style.display === "none") {
                QuickLink.style.display = "block";
                sessionStorage.removeItem("QuickLinks");
                sessionStorage.setItem("QuickLinks", "1");
                //alert(sessionStorage.getItem("QuickLinks"));
            } else {
                QuickLink.style.display = "none";
                sessionStorage.removeItem("QuickLinks");
                sessionStorage.setItem("QuickLinks", "0");
                //alert(sessionStorage.getItem("QuickLinks"));
            }
        }

    </script>

    <style>

        .navbar-default { border-bottom: none !important; }

        .navbar { background-color: #808080 !important; }

        .navbar-nav > li { padding-left: 10px; }

        .navbar .nav > li > a,
        .navbar .nav > li > a:first-letter,
        .navbar .nav > li.current-menu-item > a,
        .navbar .nav > li.current-menu-ancestor > a {
            display: inline;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: large !important;
            padding: 10px 20px;
        }

        .navbar-light .navbar-brand {
            color: #FFFFFF;
            padding-right: 50px
        }

        .navbar-light .navbar-nav .active > .nav-link, .navbar-light .navbar-nav .nav-link.active, .navbar-light .navbar-nav .nav-link.show, .navbar-light .navbar-nav .show > .nav-link { color: #FFFFFF; }

        .navbar-light .navbar-nav .nav-link { color: #FFFFFF; }

        .navbar-light .navbar-nav .nav-link:focus, .navbar-light .navbar-nav .nav-link:hover { color: #555 !important; }

        #loginas {
            color: dimgray !important;
            /*font: arial !important;*/
            font-size: large !important;
            text-align: right !important;
            vertical-align: auto !important;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: 90% !important;
            /* font-size:medium */
        }

        #loginas a { color: blue !important; }

        .eGrantsWhiteTxt { border-top: 4px solid white !important; }

        .eGrantsDDbkgrnd { background-color: #808080 !important; }

        .eGrantsUpldBtnColor { background-color: #1D8215 !important; }

        .eGrantsReturnBtn {
            background-color: #808080;
            border: none;
            color: white;
            font-size: medium;
        }

        .eGrantsDocBtn {
            background-color: #4169e1;
            font-size: medium;
        }

        .sessTime {
            display: inline;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: large !important;
            padding: 10px 20px;
        }

        /*adde 4/3/2019 for return to the TOP functionality by Ayu*/

        #myBtn {
            background-color: darkcyan; /* Set a background color */
            background-color: #555; /* Add a dark-grey background on hover */
            border: none; /* Remove borders */
            border-radius: 10px; /* Rounded corners */
            bottom: 20px; /* Place the button at the bottom of the page */
            color: white; /* Text color */
            cursor: pointer; /* Add a mouse pointer on hover */
            /*--Ayu*/
            display: none; /* Hidden by default */
            font-size: 18px; /* Increase font size  
      }

      #myBtn:hover { /*--Ayu*/
            outline: none; /* Remove outline */
            padding: 15px; /* Some padding */
            position: fixed; /* Fixed/sticky position */
            right: 30px; /* Place the button 30px from the right */
            z-index: 99; /* Make sure it does not overlap */
        }
    </style>
</head>
<body>

<div class="row">
    <div class="col-lg-2" id="logo">
        <a title="Skip Header" href="#skip header">Skip Repetitive Navigation Links</a>
        <a href="@Url.Action("Index", "Egrants")">
            <img alt="alt tag" src="~/Content/images/eglogo.PNG" width="400" height="50" title="eGrant Links [shift + alt + E]" accesskey="E"/>
        </a>
    </div>
    <div class="col-lg-10" id="loginas">
        <p><span id="sessTime"></span> Logged in as:@Session["UserName"]</p>
    </div>
    <!--- <p>Need help? Email to:<a href="mailto:egrantsissues@mail.nih.gov" title="Send email for asking help">egrantsissues@mail.nih.gov</a></p> -->

</div>
<div class="row">
    <div class="col-lg-12">
        <nav class="navbar navbar-expand-sm navbar-expand-md navbar-expand-lg  navbar-light">
            @*navbar-dark bg-dark">*@
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNavBar" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNavBar">
                <ul class="navbar-nav mr-auto nav">

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navDrop" Onclick="toggleleftpanel()" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" accesskey="R" title="Quick Links [shift + alt + L]">
                            Quick Links
                        </a>
                    </li>

                    @{
                        if (Session["Menus"] != null)
                        {
                            foreach (var s in Session["Menus"].ToString().Split(','))
                            {
                                foreach (var c in s.Split('|'))
                                {
                                    var str = s.Split('|');
                                    if (c.Length > 1)
                                    {
                                        <li class="nav-item">
                                            <a class="nav-link" title="@str[0] [shift + alt + @str[1]]" accesskey="@str[1]" target="_top" href="@Url.Action("Index", c.Replace(" ", string.Empty))">@c</a>
                                        </li>
                                    }
                                }
                            }
                        }

                    }
                    <li class="nav-item">
                        <a class="nav-link" title="Institutional Files [shift + alt + F]" accesskey="F" target="_top" href="@Url.Action("Index", "InstitutionalFiles")">Institutional Files</a>
                    </li>

                    <li id="navDropDown1" class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navLink1" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" accesskey="R" title="Resources [shift + alt + R]">
                            Resources
                        </a>
                        <div class="dropdown-menu shadow p-3 mb-5 bg-white rounded" aria-labelledby="navLink1">
                            <a class="dropdown-item" target="_new" href="~/Content/eGrants Category Glossary.docx" title="eGrants Glossary">eGrants Glossary</a>
                            <a class="dropdown-item" target="_new" href="~/Content/access_number2.pdf" title="Accession">Accession</a>
                            <a class="dropdown-item" target="_self" href="~/EgrantsFunding/funding_index" title="Funding Files">Funding Files</a>
                        </div>
                    </li>
                    <li id="navDropDown2" class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" id="navLink2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" accesskey="H" title="Help [shift + alt + H]">Help</a>
                        <div class="dropdown-menu shadow p-3 mb-5 bg-white rounded" aria-labelledby="navLink2">
                            <a class="dropdown-item" href="mailto:egrantsissues@mail.nih.gov" title="Send email to Technical Support Team">Technical Support</a>
                            <a class="dropdown-item" target="_new" href="~/Content/eGrants Help Guide.pdf" title="Help Guide">Help Guide</a>
                            <a class="dropdown-item" target="_new" href="~/Content/explanation.htm" title="Icon Guide">Icon Guide</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" target="_new" href="~/Content/privacy.htm" title="Privacy Policy">Privacy Policy</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
</div>
<div class="row">
    <div class="col-lg-2" id="leftpanel" style="margin-left: 20px">
        @if (Convert.ToInt16(Session["position_id"]) >= 2)
        {
            <ul class="nav nav-pills nav-stacked" id="leftpanelS">
                <li class="nav-item">
                    <a class="nav-link" target="_blank" href="https://nciconnect.nci.nih.gov/sites/oga/SitePages/Home.aspx" title="my OGA">myOGA</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" target="_blank" href="https://apps.era.nih.gov/gmii/search/view.era?menu_itemPath=36" title="eRA GM">eRA GM</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" target="_blank" href="https://pms.psc.gov/" title="PMS">PMS</a>
                </li>
            </ul>
        }

        @if (Convert.ToInt16(Session["position_id"]) == 1)
        {
            <ul class="nav nav-pills nav-stacked" id="leftpanelP">
                <li class="nav-item">
                    <a class="nav-link" target="_blank" href="https://apps.era.nih.gov/pmm/search.era" title="PMM">PMM</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" target="_blank" href="https://apps.era.nih.gov/qvr/web/home_main.cfm" title="QVR">QVR</a>
                </li>

                @*<li class="divider"></li>*@
            </ul>
        }
    </div>

    <!--start show popup modal -->
    @*<div class="modal fade" id="timeoutModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Timeout warning</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p><span id="error">Warning</span>: you will be logged off in <span id="count-down">00:20</span> due to inactivity.</p>
                    <p>Do you wish to continue working in your session ?</p>
                    <div class="progress">
                        <div id="timeout-progress" class="progress-bar" role="progressbar" aria-valuenow="@Session.Timeout" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="timeout_continue()">Continue</button>
                    <button type="button" class="btn btn-primary" onclick="timeout_logout()">Logout</button>
                </div>
            </div>
        </div>
    </div>*@

    <!--Start Show Session Expire Warning Popup here -->
    <div class="modal fade" id="session-expire-warning-modal" aria-hidden="true" data-keyboard="false" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Session Expire Warning</h4>
                </div>
                <div class="modal-body">
                    Your session will expire in <span id="seconds-timer">30</span> seconds. 
                    <p>
                    <p>
                    Do you want to extend the session?
                </div>
                <div class="modal-footer">
                   @* <button id="btnOk" type="button" class="btn btn-default" style="padding: 6px 12px; margin-bottom: 0; font-size: 14px; font-weight: normal; border: 1px solid transparent; border-radius: 4px;  background-color: #428bca; color: #FFF;">Continue</button>*@
                    <button id="btnSessionExpiredCancelled" type="button" class="btn btn-default" data-dismiss="modal" style="padding: 6px 12px; margin-bottom: 0; font-size: 14px; font-weight: normal; border: 1px solid transparent; border-radius: 4px; background-color: #428bca; color: #FFF;">Continue</button>
                    @*<button id="btnLogoutNow" type="button" class="btn btn-default" style="padding: 6px 12px; margin-bottom: 0; font-size: 14px; font-weight: normal; border: 1px solid transparent; border-radius: 4px;  background-color: #428bca; color: #FFF;">Logout now</button>*@
                </div>
            </div>
        </div>
    </div>
    <!--End Show Session Expire Warning Popup here -->
    <!--Start Show Session Expire Popup here -->
    <div class="modal fade" id="session-expired-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Session Expired</h4>
                </div>
                <div class="modal-body">
                    Your session is expired. You may have to login again to recreate the session.
                </div>
                <div class="modal-footer">
                    <button id="btnExpiredOk" onclick="sessionExpiredRedirect()" type="button" class="btn btn-primary" data-dismiss="modal" style="padding: 6px 12px; margin-bottom: 0; font-size: 14px; font-weight: normal; border: 1px solid transparent; border-radius: 4px; background-color: #428bca; color: #FFF;">Ok</button>
                </div>
            </div>
        </div>
    </div>
    <!-- This will init session -->
    <script>
        initSessionMonitor();
    </script>
    <!--end show popup modal-->
    <div class="col-lg-9" id="mainbody">
        <br />@RenderBody()
    </div><!--end container body-content-->
</div>

</body>
</html>