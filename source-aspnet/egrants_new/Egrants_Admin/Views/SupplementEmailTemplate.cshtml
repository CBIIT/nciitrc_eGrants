@{
    ViewBag.Title = "egrants [Supplement Email Template]";
    Layout = "~/Shared/Views/_egrants_header.cshtml";
}

<script language="JavaScript">
        var currenturl = window.document.location.href;

        $(document).ready(function () {
            load_default();
        });

        function load_default() {
            if (document.getElementById("hidReturnNotice").value != '') {
                alert(document.getElementById("hidReturnNotice").value);
            }

            if (document.getElementById("hidAct").value == 'load' || document.getElementById("hidAct").value == 'create') {
                to_create();
            }

            if (document.getElementById("hidAct").value == 'review') {
                document.getElementById("CreateET").style.display = "none";
                document.getElementById("EditET").style.display = "inline";
                document.getElementById("ReviewET").style.display = "inline";
            }
        }

        function to_create() {
            if (document.getElementById("CreateET").style.display=="none"){
                document.getElementById("CreateET").style.display="inline";
            }
            document.getElementById("txtETid").value = "";
            document.getElementById("txtETname").value = "";
            document.getElementById("txtETname").focus();
            document.getElementById("txtETsubject").value = "";
            document.getElementById("txtETbody").value = "";
            document.getElementById("EditET").style.display = "none";
            document.getElementById("ReviewET").style.display = "none";
        }

        function email_template_act(act) {
            //action for email template
            if (act == 'show') {
                var id = document.getElementById("ddlEmailMaster").options[document.getElementById("ddlEmailMaster").selectedIndex].id;
                var url="@Url.Action("View_Email_Template", "Supplement")?id=" + id;
                window.document.location.href = url;
            }

            if (act == 'create' || act == 'edit') {
                if (get_email_template_name() == false || get_email_template_name() == 'false') {
                    return true;
                } else var etname = get_email_template_name();

                if (get_et_subject() == false || get_et_subject() == 'false') {
                    return true;
                } else var etsubject = get_et_subject();

                if (get_et_body() == false || get_et_body() == 'false') {
                    return true;
                } else var etbody = get_et_body();

                if (etname != '' && etsubject != '' && etbody != '') {
                    if (confirm('Are you sure that you want to ' + act + ' this eamil template ?')) {
                        var url="@Url.Action("Create_Email_Template", "Supplement")?name=" + etname + "&subject=" + etsubject + "&detail=" + etbody;
                        //alert(url);
                        window.document.location.href = url;
                    }
                }
            }

            if (act == 'review') {
                var ETbody = get_et_body()
                //var txt_area = document.createElement("textarea");
                //txt_area.innerHTML = ETbody;
                //ETbody = txt_area.value;
                var win = window.open("", "Title", "toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=980, height=600, top=200, left=200");
                win.document.write(ETbody);
            }
        }

        function get_email_template_name() {
            if (document.getElementById("txtETname").value == '') {
                alert("Please insert name for new email template");
                document.getElementById("txtETname").focus();
                return false;
            } else var result = CheckACMusername(document.getElementById("txtETname").value, "Email name");
            if (result == false || result == 'false') {
                document.getElementById("txtETname").value = "";
                document.getElementById("txtETname").focus();
                return false;
            } else return document.getElementById("txtETname").value;
            return true;
        }

        function get_et_subject() {
            //find Email Subject
            if (document.getElementById("txtETsubject").value == '') {
                alert("Please insert subject for new email template");
                document.getElementById("txtETsubject").focus();
                return false;
            } else return document.getElementById("txtETsubject").value;
            return true;
        }

        function get_et_body() {
            //find Email body
            if (document.getElementById("txtETbody").value == '') {
                alert("Please insert body for for new email template");
                document.getElementById("txtETbody").focus();
                return false;
            } else return document.getElementById("txtETbody").value;
            return true;
        }
</script>

<div id="main">
    <!--start main-->
    <form name="frmGetInfo">
        <input type="text" hidden id="hidID" name="id" value="@ViewBag.ID" />
        <input type="text" hidden id="hidAct" name="act" value="@ViewBag.Act" />
        <input type="text" hidden id="hidReturnNotice" name="ReturnNotice" value="@ViewBag.ReturnNotice" />
    </form>

    <div>
        @Html.Partial("~/Egrants_Admin/Views/_AdminMenuIndex.cshtml")
    </div>
    <div id="caption">
        <b id="page_title">Admin Supplement</b><br />
        @Html.ActionLink("eRA Notification", "Index", "Supplement", new { area = "Egrants_Admin" }, null) |
        @Html.ActionLink("Email Template", "Load_Email_Template", "Supplement", new { area = "Egrants_Admin" }, null) |
        @Html.ActionLink("Workflow", "Load_Workflow", "Supplement", new { area = "Egrants_Admin" }, null)
    </div>
    <div class="form-inline">
        <table width="800" id="report">
            <tr>
                <td valign="top">
                    <table width="200" valign="top">
                        <tr>
                            <td height="30" width="200" align="center">
                                <a href="JavaScript:to_create()">Create New Email Template</a>
                            </td>
                        </tr>
                        <tr><td align="center"><lable for="email template"><b>Select email Template:</b></lable></td></tr>
                        <tr>
                            <td align="center" valign="top">
                                <select id="ddlEmailMaster" name="EMMaster" class="form-control" style="height:300px; width:270px;" multiple="" title="Select email master" onchange="email_template_act('show')">
                                    @foreach (var template in ViewBag.EmailTemplate)
                                    {
                                        <option id="@template.id">@template.template_name</option>
                                    }
                                </select>
                            </td>
                        </tr>
                    </table>
                </td>
                <td>
                    <table width="500">
                        <tr><td colspan="2"><center><b><h4>Let's Create eMail Template</h4></b></center></td></tr>
                        <tr><td width="50"></td><td width="400">&#183;&#0160;Create a new email template to assign to a notification in workflow</td></tr>
                        <tr><td width="50"></td><td width="400">&#183;&#0160;OR Select an existing template from the drop down list<br /><br /></td></tr>
                        <tr>
                            <td><lable for="email template name"><b>Name:</b></lable></td>
                            <td>
                                @if (Convert.ToString(ViewBag.ID) != null)
                                {
                                    foreach (var ETname in ViewBag.EmailTemplate)
                                    {
                                        if (Convert.ToInt16(ETname.id) == Convert.ToInt16(ViewBag.ID))
                                        {
                                            <input type="text" id="txtETname" class="form-control" style="height:30px; width:200px;" value="@ETname.template_name" />
                                        }
                                    }
                                }
                                else
                                {
                                    <input type="text" id="txtETname" class="form-control" style="height:30px; width:200px;" />
                                }
                                <lable for="id"><b>ID:</b></lable>&#0160;<input type="text" id="txtETid" value="@ViewBag.ID" class="form-control" style="height:30px; width:150px;" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td><lable for="email subject"><b>Subject:</b></lable></td>
                            <td>
                                <textarea id="txtETsubject" class="form-control" style="height:50px; width:400px;">
                                    @if (Convert.ToString(ViewBag.ID) != null)
                                    {
                                        foreach (var ETsubject in ViewBag.EmailTemplate)
                                        {
                                            if (Convert.ToInt16(ETsubject.id) == Convert.ToInt16(ViewBag.ID))
                                            {
                                                @ETsubject.subject
                                            }
                                        }
                                    }
                                </textarea>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <lable for="email body"><b>Body:</b></lable>
                            </td>
                            <td>
                                <textarea id="txtETbody" class="form-control" style="height:100px; width:400px;">
                                    @if (Convert.ToString(ViewBag.ID) != null)
                                    {
                                        foreach (var ETbody in ViewBag.EmailTemplate)
                                        {
                                            if (Convert.ToInt16(ETbody.id) == Convert.ToInt16(ViewBag.ID))
                                            {
                                                @Server.HtmlDecode(ETbody.body)
                                            }
                                        }
                                    }
                                </textarea>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" align="center">
                                <br />
                                <div class="menu" id="ReviewET" style="display:none">
                                    <button accesskey="R" class="btn btn-primary btn-sm" onclick="email_template_act('review')" title="Click here to review email Template body [shift + alt + R]">
                                        <u>R</u>eview Template Body
                                    </button>
                                </div>

                                <div class="menu" id="CreateET" style="display:inline">
                                    <button accesskey="C" class="btn btn-primary btn-sm" onclick="email_template_act('create')" title="Click here to create new email Template [shift + alt + C]">
                                        <u>C</u>reate New Email Template
                                    </button>
                                </div>
                                &#183;&#0160;
                                <div class="menu" id="EditET" style="display:none">
                                    <button class="btn btn-primary btn-sm" onclick="email_template_act('edit');" title="Click here to save edited email Template [shift + alt + S]" disabled="disabled">
                                        <u>S</u>ave Edited Email Template
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr><td height="10" colspan="2"></td></tr>
        </table>
    </div>
    <br /><br />
</div><!--end main-->
