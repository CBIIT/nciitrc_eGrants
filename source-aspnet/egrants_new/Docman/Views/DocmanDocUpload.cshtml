@{
    ViewBag.Title = "DocMan [Document Contract]";
    Layout = "~/Shared/Views/_docman_header.cshtml";
}


<link rel="stylesheet" type="text/css" href="~/Content/DragdropArea.css" />
<script src="~/scripts/dragdrop.js"></script>
<script src="~/scripts/ProgressBar.js"></script>

<script language="JavaScript">
        var currenturl = window.document.location.href;
        var main_category_id;
        var DocDate = "";
        var SeqNum = "";
        var frmdata = new FormData();

        $(document).ready(function () {
            set_default();
        });

        function set_default() {
            switch_upload_mode("by_ddrop");

            //var BrowserType = document.getElementById("hidBrowserType").value;
            //alert(BrowserType);
            //if (BrowserType.indexOf("Chrome") != -1 || BrowserType.indexOf("IE") != -1 || BrowserType.indexOf("InternetExplorer") != -1) {
            //    switch_upload_mode("by_ddrop");
            //} else switch_upload_mode("by_file");
        }

        function get_docdate() {
            if (document.getElementById("txtDocDate").value == '') {
                alert("Please insert document date");
                document.getElementById("txtDocDate").focus();
                return false;
            } else if (isDate(document.getElementById("txtDocDate").value) == false) {
                document.getElementById("txtDocDate").value = "";
                document.getElementById("txtDocDate").focus();
                return false;
            } else return document.getElementById("txtDocDate").value;
        }

        function get_reason() {
            if (document.getElementById("txtDescription").value == '') {
                alert("Please enter the reason to replace");
                document.getElementById("txtDescription").focus();
                return false;
            } else var result = CheckCharacters(document.getElementById("txtDescription").value, "replace reason");

            //check special characters
            if (result == false || result == 'false') {
                document.getElementById("txtDescription").value = "";
                document.getElementById("txtDescription").focus();
                return false;
            } else return document.getElementById("txtDescription").value;
        }

        function switch_upload_mode(act) {
            if (act == "by_ddrop") {
                document.getElementById("by_ddrop").style.display = "inline";
                document.getElementById("by_file").style.display = "none";
                document.getElementById("by_email").style.display = "none";
                Init();
            }

            if (act == "by_file") {
                document.getElementById("by_file").style.display = "inline";
                document.getElementById("by_ddrop").style.display = "none";
                document.getElementById("by_email").style.display = "none";
            }

            if (act == "by_email") {
                document.getElementById("by_email").style.display = "inline";
                document.getElementById("by_ddrop").style.display = "none";
                document.getElementById("by_file").style.display = "none";
            }
        }

        function upload_doc_by_ddrop(econ_id, doc_id) {
            //get doc date
            if (get_docdate() == false) {
                return false;
            } else DocDate = get_docdate();

            //get id
            if (get_reason() == false) {
                return false;
            } else SeqNum = get_reason();

            frmdata.append('dropedfile', dropedfile);
            frmdata.append('econ_id', econ_id);
            frmdata.append('doc_date', DocDate);
            frmdata.append('seq_num', SeqNum);
            frmdata.append('doc_id', doc_id);
            docupload(frmdata, "/Docman/Upload_Doc_by_DDrop");

            //refresh after upload
            var url = "@Url.Action("by_id","Docman")?econ_id=" + econ_id;
            window.self.location = url;
        }

        function upload_doc_by_file(econ_id, doc_id) {
            //get doc date
            if (get_docdate() == false) {
                return false;
            } else DocDate = get_docdate();

            //get replace reason
            if (get_reason() == false) {
                return false;
            } else SeqNum = get_reason();

            //check loacte file, file type and file size
            if (check_file() == false) {
                return false;
            } else var file = document.getElementById('UploadFile').files[0];

            frmdata.append('file', file);
            frmdata.append('econ_id', econ_id);
            frmdata.append('doc_date', DocDate);
            frmdata.append('seq_num', SeqNum);
            frmdata.append('doc_id', doc_id);
            docupload(frmdata, "/Docman/Upload_Doc_by_File");

            //refresh after upload
            var url = "@Url.Action("by_id","Docman")?econ_id=" + econ_id;
            window.self.location = url;
        }

        function upload_doc_by_email(econ_id, doc_id) {
            //get doc date
            if (get_docdate() == false) {
                return false;
            } else DocDate = get_docdate();

            //get replace reason
            if (get_reason() == false) {
                return false;
            } else SeqNum = get_reason();

            if (doc_date != '' && reason != '') {
                var email_body = 'Before sending the email:%0D%0A %0D%0A 1. Attach the document to upload to this email.%0D%0A 2. If necessary, change the document date in the subject line (maintain the date format mm/dd/yyyy).%0D%0A 3. Send the email. %0D%0A %0D%0A  Changing any other information in the Subject: or the To: lines will cause an unsuccessful upload.%0D%0A %0D%0A Note:There may be a time delay of up to 15 minutes before the uploaded file is available for your review.';
                var subject = "docid=" + doc_id + ", date=" + DocDate + ", reason=" + SeqNum;
                var maillink = 'mailto:' + document.frmGetInfo.docman_email.value + '?subject=' + subject + '&body=' + email_body;
                window.open(maillink, "_self");
            } else return false;
        }

</script>

<form name="frmGetInfo">
    <input type="hidden" id="hidBrowserType" name="browser_type" value="@Convert.ToString(Session["browser"])" />
    <input type="hidden" id="docmanemail" name="docman_email" value="@ViewBag.DocmanEmail" />
    <input type="hidden" id="econid" name="econid" value="@ViewBag.EconID" />
</form>
<div id="main">
    <div id="caption">
        <b id="page_title">DocMan:Replace Document Image</b>
    </div>

    <br />
    <div id="modify" class="form-inline">
        @if (ViewBag.DocmanContract != null)
        {
            @Html.Partial("~/Docman/Views/_docman_Contract.cshtml");
        }

        <!--start document layer-->
        @if (ViewBag.DocmanDocument != null)
        {
            foreach (var item in ViewBag.DocmanDocument)
            {
                if (Convert.ToInt16(item.tag) == 3 && Convert.ToInt32(item.document_id) == Convert.ToInt32(ViewBag.DocID))
                {
                    <table>
                        <tr><td></td><td colspan="3">-----------------------------------------------------------------------------------------------------------------------------------------------</td></tr>
                        <tr>
                            <td width="20"></td>
                            <td width="80"><lable for="document"><b>Document:</b></lable></td>
                            <td width="450"><a href="@item.url" target="_new">@item.doc_label</a></td>
                            <td width="300">@item.document_date</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><lable for="document date"><b>Date:</b></lable></td>
                            <td>
                                <input type="text" name="Docdate" id="txtDocDate" class="form-control" style="height:30px; width:120px;" value="@item.document_date" />&#0160;(mm/dd/yyyy)
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><lable for="reason for replace"><b>Replace Reason:</b></lable></td>
                            <td colspan="2"><input type="text" name="description" id="txtDescription" class="form-control" style="height:30px; width:420px;" /></td>
                        </tr><!--end document info -->
                        <tr>
                            <td colspan="2">
                                <!--show loading icon-->
                                <div class="loading" style="display:none">
                                    <img src="~/Content/images/Loading.gif" width="80" />
                                </div>
                            </td>
                            <td colspan="2">
                                <ul class="nav nav-tabs">
                                    <li class="active"><a href="Javascript:switch_upload_mode('by_ddrop')" @*aria-expanded="true" data-toggle="tab"*@>Drag & Drop</a></li>
                                    <li></li>
                                    <li class="active"><a href="Javascript:switch_upload_mode('by_file')" @*aria-expanded="true" data-toggle="tab"*@>Locate File and Upload</a></li>
                                    <li></li>
                                    <li class="active"><a href="Javascript: switch_upload_mode('by_email')" @* aria-expanded="true" data-toggle="tab"*@>Upload <I>via</I> Email</a></li>
                                </ul>
                                <div class="tab-content" id="myTabContent">
                                    <!--start upload by drag drop -->
                                    <div class="tab-pane fade active in" id="by_ddrop" style="display:none">
                                        <br />
                                        <div id="dropArea">
                                            Drop only one file here to upload document
                                        </div>
                                        <br />
                                        <button type="button" id="btnDragdrop" class="btn btn-primary btn-sm" accesskey="U" OnClick="return upload_doc_by_ddrop('@ViewBag.EconID','@ViewBag.DocID')" title="Click here to upload document image [shift + alt + U]" disabled="disabled">
                                            <U>U</U>pload Document
                                        </button>
                                    </div>
                                    <!--end upload by drag drop -->
                                    <!--start upload by file-->
                                    <div class="tab-pane fade active in" id="by_file" style="display:none">
                                        <br />
                                        @using (Html.BeginForm("Upload_Doc_by_File", "Docman", FormMethod.Post, new { enctype = "multipart/form-data" }))
                                        {
                                            <input type="hidden" id="hidEconID" name="econ_id" value="@ViewBag.EconID" />
                                                    <input type="hidden" id="hidDocID" name="doc_id" value="@ViewBag.DocID" />
                                                    <input type="hidden" id="hidDocDate" name="doc_date" />
                                                    <input type="hidden" id="hidSeqNum" name="seq_num" />
                                                    <input type="file" name="file" id="UploadFile" />
                                                    <br />
                                                    <button type="button" id="btnFileUpload" accesskey="U" class="btn btn-primary btn-sm" title="Click here to upload document image [shift + alt + U]" OnClick="return upload_doc_by_file('@ViewBag.EconID','@item.document_id')">
                                                        <U>U</U>pload Document
                                                    </button>
                                        }
                                    </div>
                                    <!--end upload by file-->
                                    <!--start upload by email-->
                                    <div class="tab-pane fade active in" id="by_email" style="display:none">
                                        <br />
                                        &#0160;<b>How to Upload Via Email?</b><br />
                                        &#0160;&#0160;1, Update document date and insert reason of replace.<br />
                                        &#0160;&#0160;2, Click the button "Upload Via Email" This will popup an outlook email window.<br />
                                        &#0160;&#0160;3, Just attach document (don't change the subject) and send.<br /><br />
                                        <button type="button" accesskey="U" class="btn btn-primary btn-sm" title="Click here to upload document image by email[shift + alt + U]" OnClick="return upload_doc_by_email('@ViewBag.EconID','@ViewBag.DocID')">
                                            <U>U</U>pload Via Email
                                        </button>
                                    </div>
                                </div>
                                <br />
                                <!--show progress bar-->
                                <div class="progress" style="display:none; margin:0; padding:0;">
                                    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <!--end progress bar-->
                            </td>
                        </tr>
                    </table>
                }
            }<!--end for each-->
        }<!--end document layer-->
        <br />
    </div>
    @ViewBag.Message<br />
    <a target="_self" href="@Url.Action("by_id", "Docman", new { econ_id = ViewBag.EconID})" title="Click to display documents">Return</a>
</div>
<br /><br /><br /><br /><br />




