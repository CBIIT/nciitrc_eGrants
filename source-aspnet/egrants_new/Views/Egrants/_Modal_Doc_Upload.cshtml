@{
    ViewBag.Title = "eGrants [Document Upload Module]";
}

<link rel="stylesheet" type="text/css" href="~/Content/DragdropArea.css" />

<script language="javascript" type="text/javascript">
    var currenturl = window.document.location.href;

    //set default
    $(document).ready(function () {
        set_default();
    });

    //cancel upload
    //$('#btnCancel').click(function () {
        //$('#PopupModal').modal('hide');
    //});

    function set_default() {
        switch_upload_mode("by_ddrop");
        //var BrowserType = document.getElementById("hidBrowserType").value;
        ////alert(BrowserType);
        //if (BrowserType.indexOf("Chrome") != -1) {
        //    switch_upload_mode("by_file");
        //} else switch_upload_mode("by_ddrop");

        //$('#btnFileUpload').attr("disabled", "disabled");
    }

    function switch_upload_mode(act) {
        if (act == "by_ddrop") {
            document.getElementById("by_ddrop").style.display = "inline";
            document.getElementById("by_file").style.display = "none";
            Init();
        }

        if (act == "by_file") {
            document.getElementById("by_file").style.display = "inline";
            document.getElementById("by_ddrop").style.display = "none";
        }
    }

    function clear_message(type) {
        //clear all message
        $("#mssg").css('display', 'none');
        $('#notice').css('visibility', 'hidden');
        //if (type == "by_file") {
        //    document.getElementById("UploadFile").value = "";
        //}
    }

    function upload_by_ddrop() {
        var frmdata = new FormData();
        var document_id = document.getElementById('hidDocID').value;

        frmdata.append('dropedfile', dropedfile);
        frmdata.append('doc_id', document_id);
        docupload(frmdata, "/EgrantsDoc/doc_upload_by_ddrop");
        //$('#btnDragdrop').attr("disabled", "disabled");
        //document.getElementById("btnDragdrop").disabled = "disabled";
        clear_all("by_dd");
    }

    function upload_by_file() {
        if (check_file() == false) {
            return false;
        } else var file = document.getElementById('UploadFile').files[0];
        var frmdata = new FormData();
        var document_id = document.getElementById('hidDocID').value;

        frmdata.append('file', file);
        frmdata.append('doc_id', document_id);
        docupload(frmdata, "/EgrantsDoc/doc_upload_by_file");
        //$('#btnFileUpload').attr("disabled", "disabled");
        clear_all("by_file");
    }

    function clear_all(act) {
        if (act == "by_file") {
            document.getElementById("btnFileUpload").disabled = "disabled";
        } else if (act == "by_dd") {
            document.getElementById("btnDragdrop").disabled = "disabled";
        }
    }

    function refresh() {
        location.reload();

        //if ('referrer' in document) {
        //    window.location = document.referrer;
        //} else {
            //window.history.back();
        //}
    }

    function active_btnFileUpload() {
        if (document.getElementById("btnFileUpload").disabled == true) {
            document.getElementById("btnFileUpload").disabled = false;
        }
    }

</script>

@{
    string full_grant_num = "";
    string document_name = "";
    string document_date = "";

    foreach (var doc in ViewBag.DocInfo)
    {
        full_grant_num = doc.full_grant_num;
        document_name = doc.document_name;
        document_date = doc.document_date;
    }

    <div id="main" style="margin:0;padding:0;">
        <form name="frmGetInfo">
            <input type="text" hidden id="hidDocID" name="document_id" value="@ViewBag.DocId" />
            <input type="text" hidden id="hidBrowserType" name="browser_type" value="@Convert.ToString(Session["browser"])" />
        </form>

        <!--start upload document-->
        @*<div id="content" style="margin:0; padding:0;">*@
        <table width="500">
            <thead>
                <tr><td colspan="2" height="20"></td></tr>
                <tr><td colspan="2" height="20"><b>Grant:</b>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;@full_grant_num</td></tr>
                <tr><td colspan="2" height="20"><b>Category:</b>&#0160;&#0160;@document_name</td></tr>
                <tr><td colspan="2" height="20"><b>Date:</b>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;@document_date</td></tr>
                <tr><td colspan="2" height="20"></td></tr>
            </thead>
            <tbody>
                <tr>
                    <!--show loading icon-->
                    <td colspan="2" valign="middle">
                        <ul class="nav nav-tabs" style="width:450px">
                            <li class="active"><a href="Javascript:switch_upload_mode('by_ddrop')">Drag & Drop</a></li>
                            <li></li>
                            <li class="active"><a href="Javascript:switch_upload_mode('by_file')">Locate File and Upload</a></li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                            <!--start upload by drag drop -->
                            <div class="tab-pane fade active in" id="by_ddrop" style="display:none">
                                <br />
                                <div id="dropArea">Drag-drop only one file here to upload</div><br />
                                <button type="button" name="ReplaceByDdrop" id="btnDragdrop" disabled="disabled" onclick="return upload_by_ddrop();" class="btn btn-primary btn-sm" accesskey="U" title="Click here to upload document [shift + alt + U]"><u>U</u>pload Document</button>
                                <button type="button" data-dismiss="modal" accesskey="C" class="btn btn-primary btn-sm" title="Click here to cancel upload [shift + alt + C]"><u>C</u>ancel</button>&#0160;&#0160;
                                @*<a accesskey="B" href="Javascript: refresh()" title="Click here to return original page [alt + shift + B]"><b id="note">Return & Refresh</b></a>*@
                                @*<button type="button" name="return" id="btnReturn" accesskey="R" class="btn btn-primary btn-sm" title="Click here to return [shift + alt + R]" onclick="return refresh()"><u>R</u>eturn and Refresh</button>*@
                            </div>
                            <!--end upload by drag drop-->
                            <!--start upload by file-->
                            <div class="tab-pane fade active in" id="by_file" style="display:none">
                                <div>
                                    <br />
                                    <input type="file" name="file" id="UploadFile" style="width:400px; height:30px;" onchange="active_btnFileUpload()" /><br />
                                    <button type="button" name="ReplaceByFile" id="btnFileUpload" onclick="return upload_by_file();" class="btn btn-primary btn-sm" disabled="disabled" accesskey="U" title="Click here to upload document [shift + alt + U]"><u>U</u>pload Document</button>
                                    <button type="button" data-dismiss="modal" accesskey="C" class="btn btn-primary btn-sm" title="Click here to cancel upload [shift + alt + C]"><u>C</u>ancel</button>&#0160;&#0160;
                                    @*<a accesskey="B" id="refresh" href="Javascript: refresh()" title="Click here to return original page [alt + shift + B]"><b id="note">Return & Refresh</b></a>*@
                                    @*<button type="button" name="return" id="btnReturn" accesskey="R" class="btn btn-primary btn-sm" title="Click here to return [shift + alt + R]" onclick="return refresh()"><u>R</u>eturn and Refresh</button>*@
                                </div>
                            </div>
                            <!--end upload by file-->
                        </div>
                    </td>
                </tr>
                <tr>
                    <td width="500" height="30">
                        <!--show progress bar-->
                        <div class="progress" style="display:none">
                            <div id="progressBar" class="progress-bar" role="progressbar" style="width:0%; height:18px; text-align: center; line-height:18px; margin:0; padding:0;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <!--end progress bar-->
                    </td>
                    <td width="80"><div class="loading" style="display:none"><img src="~/Content/images/Loading.gif" width="50" /></div></td>
                </tr>
            </tbody>
        </table>
        <b id="done"><span id="mssg"></span></b>&#0160;&#0160;
        @*<a target="_new" href="#" id="notice" style="visibility:hidden"><b>Check uploaded file</b></a>*@
        @*</div>*@<!--end content-->
    </div><!--end main-->
}

<script src="~/scripts/dragdrop.js"></script>
<script src="~/scripts/ProgressBar.js"></script>








