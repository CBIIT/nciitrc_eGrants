@using egrants_new.Dashboard.Models
@{
    ViewBag.Title = "egrants [NCI OGA]";
    Layout = "~/Shared/Views/_egrants_header.cshtml";
}

<link href="~/Content/jquery-ui.min.css" rel="stylesheet"/>
<script src="~/scripts/EgrantsCatsZone.js"></script>
<script src="~/scripts/EgrantsQC.js"></script>
<script src="~/scripts/bluebird.js"></script>
<script src="~/scripts/jquery-ui-1.13.2.min.js"></script>
<!-- Bootstrap Font Icon CSS -->
<link rel="stylesheet" href="~/Content/bootstrap-icons.min.css"/>


<script language="JavaScript" type="text/javascript">
    var currenturl = window.document.location.href;
    var mode;

    var can_qc = 0;

    var ShowToggleAppls = 0; // indicate toggle appls showing or hide
    var ShowToggleCats = 0; // indicate toggle cats showing or hide
//   var CurrentDownloadValue = ""; // indicate toggle download showing or hide

    var SelectAllDocs = 0; // indicate select all docs to qc
    var SelectAllCats = 0;

    var cats_list = [];
    var appls_list = [];

    var SelectAllApplsCheckBox = 0;

    var currentView = "StandardForm";

    $(document).ready(function() {
        set_default();
    });

    function set_default() {
        // set nci as default IC
        if (document.getElementById("hidFilterAdminCode").value != "") {
            $('#AdminCode').val(document.getElementById("hidFilterAdminCode").value);
        } else $('#AdminCode').val('CA');

        // show search form or show toggle
        var grant_id = document.getElementById("hidGrantID").value;
        var appl_id = document.getElementById("hidApplID").value;
        var selected_appls = document.getElementById("hidSelectedAppls").value;
        var selected_years = document.getElementById("hidSelectedYears").value;

        // show search form but not show toggle bar
        if ((grant_id == "" && appl_id == "") || (grant_id != "" && appl_id == "")) {

            // check search str
            if (document.getElementById("txtKW")) {
                if (document.getElementById("hidSearchStr").value != "" && (document.getElementById("hidSearchStr").value).length > 2 && document.getElementById("hidSearchStr").value.substring(0, 7) != "filters") {
                    document.getElementById("txtKW").value = document.getElementById("hidSearchStr").value;
                } else document.getElementById("txtKW").focus();
            }

            // load data for filters
            if (document.getElementById("hidFilterFY").value != "" && document.getElementById("hidFilterFY").value != 0) {
                document.getElementById("FiscalYear").value = document.getElementById("hidFilterFY").value;
            }

            if (document.getElementById("hidFilterMechanism").value != "") {
                document.getElementById("Mechanism").value = document.getElementById("hidFilterMechanism").value;
            }

            if (document.getElementById("hidFilterSerialNumber").value != "" && document.getElementById("hidFilterSerialNumber").value != 0) {
                document.getElementById("SerialNumber").value = document.getElementById("hidFilterSerialNumber").value;
            }

            // fill value for FiscalYear text Thanks for pushing it through. box
            if (document.getElementById("hidFilterFY").value != "") {
                document.getElementById("FiscalYear").value = document.getElementById("hidFilterFY").value;
            }

            // fill value for years textbox
            if (document.getElementById("hidSelectedYears").value != "" && document.getElementById("hidSelectedYears").value != "undefined") {
                var selectedYears = document.getElementById("hidSelectedYears").value;
                if (document.getElementById("hidGrantID").value != "" && selectedYears.length <= 3) {
                    // var grant_id = document.getElementById("hidGrantID").value;
                    var el = "txtYears_" + grant_id;
                    document.getElementById(el).value = document.getElementById("hidSelectedYears").value;
                }
            }

            // fill value for FiscalYear text Thanks for pushing it through. box
//         if (document.getElementById("hidDownloadForm").value == "") {
//            document.getElementById("hidDownloadForm").value = "Standard";
//         }
        }

        // show toggle bar but do not show search form ---
        if (grant_id != "" || appl_id != "") {

            // hide search bar
            var el = "search_bar_" + grant_id;
            document.getElementById(el).style.display = "none";
            ShowSearchForm = 0;

            // document.getElementById("toggle_bar").style.display = "inline";
            document.getElementById("toggle_appls").style.display = "inline";
            document.getElementById("toggle_title").innerHTML = "Grant Years";

            document.getElementById("show_search_form").style.display = "inline";
            document.getElementById("show_cats_toggle").style.display = "inline";
            document.getElementById("show_download_toggle").style.display = "inline";
            show_toggle_appls();
        }

        // show search form and appls_toggle icon
        if (grant_id != "" && appl_id != "") // hide search_bar and show toggle bar if (document.getElementById("hidGrantID").value != "")
        {
            // hide search bar and flag zone
            var el = "search_bar_" + grant_id;
            document.getElementById(el).style.display = "none";

            // show search bar and toggle_appls icon only
            document.getElementById("toggle_appls").style.display = "inline";

            document.getElementById("show_appls_toggle").style.display = "none";
            document.getElementById("show_search_form").style.display = "inline";
            document.getElementById("show_cats_toggle").style.display = "inline";
            document.getElementById("show_download_toggle").style.display = "inline";
        }

        // check tab data and show tab
        var el = "tab_" + document.getElementById("hidCurrentTab").value;
        if (document.getElementById(el) != null && document.getElementById(el).style.display == "none") {
            document.getElementById(el).style.display = "inline";
        }

        if (currentView == "DownloadForm") {
            $('#downloadForm').attr("hidden", false);
            $('#standardForm').attr("hidden", true);
        } else if (currentView == "StandardForm") {
            $('#downloadForm').attr("hidden", true);
            $('#standardForm').attr("hidden", false);
        }
        // get the view state from the session variable to persist value
        //if (document.getElementById("hidDownloadForm").value == "DownloadForm") {
        //   $('#downloadForm').attr("hidden", false);
        //   $('#standardForm').attr("hidden", true);
        //} else if (document.getElementById("hidDownloadForm").value == "StandardForm") {
        //   $('#downloadForm').attr("hidden", true);
        //   $('#standardForm').attr("hidden", false);
        //}
    }

    function by_str(str) {
        // alert(str);
        var url = "@Url.Action("by_str", "Egrants")?str=" + str;
        window.document.location.href = url;
    }

    function by_grant(grant_id, package_name, appls_list, categories, years) {
        mode = document.getElementById("hidMode").value;
        if (mode == "" || mode == undefined) {
            mode = "";
        }

        var url = "@Url.Action("by_grant", "Egrants")?grant_id=" + grant_id + "&package=" + package_name + "&mode=" + mode + "&appls_list=" + appls_list + "&categories=" + categories + "&years=" + years;
        // alert(url);
        window.document.location.href = url;
    }

    function by_appl(appl_id) {
        mode = document.getElementById("hidMode").value;
        if (mode == "" || mode == undefined) {
            mode = "";
        }

        var url = "@Url.Action("by_appl", "Egrants")?appl_id=" + appl_id + "&mode=" + mode;
        window.document.location.href = url;
    }

    function show_supplement(grant_id, act) {
        var url = "@Url.Action("LoadSupplement", "EgrantsDoc")?act=" + act + "&grant_id=" + grant_id;
        // alert(url);
        MeddleWindow = window.open(url, act, "toolbar=0,menubar=0,location=0,status=0,width=1000,height=500,scrollbars=yes,left=80,top=100");
        MeddleWindow.focus();
    }

    function view_supplement(grant_id, act) {
        var url = "@Url.Action("LoadSupplement", "EgrantsDoc")?act=" + act + "&grant_id=" + grant_id;
        alert(url);
    }

    // after delete or store doc
    function refresh_after_modify() {
        var url = currenturl;
        window.document.location.href = url;
    }

    // to create new document without selected grant year
    function create_new() {
        var previous_url = encodeURIComponent(currenturl);
        var url = "@Url.Action("doc_create_without_applid", "EgrantsDoc")?previous_url=" + previous_url;
        window.document.location.href = url;
    }

    // to create new document or funding document with selected grant year
    function create_new_doc(type, admincode, serialnum, appl_id) {
        var previous_url = encodeURIComponent(currenturl);
        if (type == 'doc') {
            var url = "@Url.Action("doc_create_with_applid", "EgrantsDoc")?admin_code=" + admincode + "&serial_num=" + serialnum + "&appl_id=" + appl_id + "&previous_url=" + previous_url;
        } else var url = "@Url.Action("funding_doc_default", "EgrantsFunding")?admin_code=" + admincode + "&serial_num=" + serialnum + "&appl_id=" + appl_id + "&previous_url=" + previous_url;
        window.document.location.href = url;
    }


    function getByAll(grant_id) {
        check_selected_cats(grant_id);
        by_grant(grant_id, 'All', 'All', cats_list, 'All');
    }

    function checkYears(event, grant_id) {

        var char = event.which || event.keyCode;
        // alert(char);
        if (char == 13) {
            var el = "txtYears_" + grant_id;
            var yrs = (document.getElementById(el).value).trim();
            // alert("yrs="+yrs);
            if (yrs == '' || yrs == 0 || isInteger(yrs) == false) {
                alert("Please insert correct number of the years to search");
                document.getElementById(el).value = "";
                document.getElementById(el).focus();
                return false;
            } else {
                getBySelected(grant_id);
            }
        } else {
            return false;
        }
    }

    function getBySelected(grant_id) {
        check_selected_cats(grant_id);
        // check inserted years
        var el = "txtYears_" + grant_id;
        if (document.getElementById(el).value != '') {
            var years = (document.getElementById(el).value).trim();
            if (isInteger(years) == false || years == 0) {
                alert("Please insert correct number of the years to search");
                document.getElementById(el).value = "";
                document.getElementById(el).focus();
                return false;
            } else by_grant(grant_id, 'All', 'All', cats_list, years);
        }

        if (document.getElementById(el).value == '') {
            if (document.getElementById("hidApplID").value == "") {
                by_grant(grant_id, 'All', 'All', cats_list, 'All');
            } else {
                var appl_id = document.getElementById("hidApplID").value;
                by_grant(grant_id, 'All', appl_id, cats_list, appl_id);
            }
        }
    }

    function check_selected_cats(grant_id) {
        // var SelectedCats = 0;
        cats_list = "";
        var el = "all_cats_" + grant_id;
        if (document.getElementById(el).checked == true) {
            cats_list = "All";
        } else {

            // create selected category_id list
            var checkboxes = $('div#catlist_' + grant_id + ', input[type="checkbox"]');

            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].checked == true) {
                    cats_list = cats_list + checkboxes[i].name + ',';
                }
            }

            // create selected category_id list
            if (cats_list != "" && cats_list.indexOf(",") > 0) {
                cats_list = cats_list.substring(0, cats_list.length - 1);
            }
        }

        // take off last comma
        if (cats_list == "") {
            cats_list = "All";
        }
        // alert("cats_list="+cats_list);
    }

    function send_email(email_address, email_subject, pi_name) {
        var maillink = "mailto:" + email_address + "?subject=" + email_subject + ' [' + pi_name + ']';
        window.open(maillink, "_self");
    }

    function show_grant_with_flag(flag_type, grant_id) {
        if (flag_type == "FDA" || flag_type == "MS" || flag_type == "OD" || flag_type == "DS") {
            // show appls with flag for this grant
            var categories = "All";
            var appls_list = "All";
            var url = "@Url.Action("by_grant", "Egrants")?grant_id=" + grant_id + "&package=" + flag_type + "&categories=" + categories + "&appls_list=" + appls_list + "&years=";
        } else if (flag_type == "ARRA") {
            flag_type = "All"
            var url = "@Url.Action("by_grant", "Egrants")?grant_id=" + grant_id + "&package=&categories=&appls_list=&years=";
        }
        // alert(url);
        // window.open(url, top);
        window.document.location.href = url;
    }

    // show or hide search form
    function show_search_form() {
        // show search form
        document.getElementById("searchform").style.display = "inline";
        document.getElementById("show_search_form").style.display = "none";
        // hide toggle_appls at all
        document.getElementById("show_appls_toggle").style.display = "inline";
        document.getElementById("toggle_appls").style.display = "none";
        // clean toggle_cats at all
        document.getElementById("show_download_toggle").style.display = "none";
        document.getElementById("show_cats_toggle").style.display = "none";
        document.getElementById("toggle_cats").style.display = "none";
        document.getElementById("toggle_title").innerHTML = "";
    }

    // show or hide search form
    function toggle_download_forms() {

        console.log("Check Toggle");

        if (currentView == "StandardForm") {
            console.log("in Standardform");
            $('#downloadForm').attr("hidden", false);
            $('#standardForm').attr("hidden", true);
            document.getElementById("toggle_title").innerHTML = "Audit File Download";

            currentView = "DownloadForm";

            return;
        }

        if (currentView == "DownloadForm") {

            console.log("in Downloadform");
            $('#downloadForm').attr("hidden", true);
            $('#standardForm').attr("hidden", false);
            document.getElementById("toggle_title").innerHTML = "Grant Years";
            currentView = "StandardForm";
            return;
        }
    }

    // This is the callback function that
    // processes the Web Service return value.
    function SucceededCallback(result) {
        alert(result);
    }

    // seach by selected appls and selected cats from toggles
    function search_by_toggle() {
        // alert("toggle seach");
        // alert(ShowToggleAppls);
        var grant_id = document.getElementById("hidGrantID").value;
        // to create seleted appl list by default selected
        if (ShowToggleAppls == 0) {
            if (document.getElementById("hidSelectedAppls").value != "") {
                appls_list = document.getElementById("hidSelectedAppls").value;
            } else if (document.getElementById("hidApplID").value != "") {
                appls_list = document.getElementById("hidApplID").value;
            }
        } else {
            appls_list = appls_list;
        }

        // as default, all categories should be seleted
        if (ShowToggleCats == 0) {
            if (document.getElementById("hidSelectedCats").value != "") {
                cats_list = document.getElementById("hidSelectedCats").value;
            } else cats_list = "All";
        } else {
            cats_list = cats_list;
        }

        // alert("grant_id=" + grant_id + ", appls_list=" + appls_list + ", cats_list=" + cats_list );
        if (appls_list == "") {
            alert("Please select grant year to search");
        } else if (appls_list != "" && cats_list == "") {
            alert("Please select category to search");
        } else by_grant(grant_id, 'All', appls_list, cats_list, '');
    }
</script>

<!--start save all data from server-->
<form name="frmGetInfo">

    <input type="text" hidden id="hidCurrentTab" name="CurrentTab" value="@ViewBag.CurrentTab"/>
    <input type="text" hidden id="hidPageNum" name="CurrentPage" value="@ViewBag.CurrentPage"/>
    <input type="text" hidden id="hidSearchStr" name="SearchStr" value="@ViewBag.Str"/>
    <input type="text" hidden id="hidSearchType" name="SearchType" value="@ViewBag.SearchStyle"/>
    <input type="text" hidden id="hidMode" name="Mode" value="@ViewBag.Mode"/>

    <input type="text" hidden id="hidGrantID" name="GrantID" value="@ViewBag.GrantID"/>
    <input type="text" hidden id="hidPackage" name="Package" value="@ViewBag.Package"/>
    <input type="text" hidden id="hidApplID" name="ApplID" value="@ViewBag.ApplID"/>
    <input type="text" hidden id="hidApplCount" name="ApplCount" value="@ViewBag.ApplCount"/>
    <input type="text" hidden id="hidDocCount" name="DocCount" value="@ViewBag.DocCount"/>

    <input type="text" hidden id="hidSelectedYears" name="FY" value="@ViewBag.SelectedYears"/>
    <input type="text" hidden id="hidSelectedCats" name="SelectedCats" value="@ViewBag.SelectedCats"/>
    <input type="text" hidden id="hidSelectedCategories" name="SelectedCategories" value="@ViewBag.SelectedCategories"/>
    <input type="text" hidden id="hidSelectedAppls" name="SelectedAppls" value="@ViewBag.SelectedAppls"/>

    <input type="text" hidden id="hidFilterFY" name="FilterFY" value="@ViewBag.FilterFY"/>
    <input type="text" hidden id="hidFilterMechanism" name="FilterMechanism" value="@ViewBag.FilterMechanism"/>
    <input type="text" hidden id="hidFilterAdminCode" name="FilterAdminCode" value="@ViewBag.FilterAdminCode"/>
    <input type="text" hidden id="hidFilterSerialNumber" name="FilterSerialNumber" value="@ViewBag.FilterSerialNumber"/>

    <input type="text" hidden id="hidPositionID" name="position_id" value="@Convert.ToInt16(Session["position_id"])"/>
    <input type="text" hidden id="hidImageServer" name="ImageServer" value="@Convert.ToString(Session["ImageServer"])"/>
    <input type="text" hidden id="hidEgrantsEmail" name="egrantsemail" value="@Convert.ToString(Session["egrantsDocEmail"])"/>
    <input type="text" hidden id="hidDownloadForm" name="DownloadSubPage" value="@ViewBag.CurrentView"/>
</form>
<!--end save all data from server-->
<!--start main-->
<div id="main">
@if (ViewBag.GrantID != null)
{
    <div id="toggle_bar" style="display: inline; width: 950px;">
        <div id="show_search_form" style="display: none;">
            <a href="Javascript:show_search_form()" title="View Search Filters">
                <img style="height: 32px; vertical-align: middle;" src="~/Content/images/search.png"/>
            </a>
        </div>
        <div id="show_appls_toggle" style="display: none;">
            <a href="JavaScript:show_toggle_appls()" title="View Grant Years">
                <img style="width: 40px;" src="~/Content/images/appls_toggle.png"/>
            </a>
        </div>
        <div id="show_cats_toggle" style="display: none;">
            <a href="#" onclick="Javascript:return before_show_toggle_cats()">
                <img style="vertical-align: middle; width: 40px;" src="~/Content/images/filter.png" title="View Category Filter"/>
            </a>
        </div>

        <div id="title_for_toggle" style="display: inline; margin-left: 300px; width: 950px;">
            <b id="toggle_title" style="font-size: medium;"></b>
        </div>
        @if (Convert.ToInt16(Session["position_id"]) >= 2)
        {
            <div id="show_download_toggle" style="display: none;">

                <a href="#" onclick="Javascript:return toggle_download_forms()" title="Audit File Download">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                    </svg>
                </a>
            </div>
        }

    </div>

    // show appls toggle
    <div>
        @Html.Partial("~/Egrants/Views/_egrants_showApplsToggle.cshtml")
    </div>

    // show categories toggle
    <div>
        @Html.Partial("~/Egrants/Views/_egrants_showCatsToggle.cshtml")
    </div>
}

<!--adde 4/3/2019 for return to the TOP functionality by Ayu-->
<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button> @*--AYu*@

<!--show search form-->
@Html.Partial("~/Egrants/Views/_egrants_showSearchForm.cshtml")<br/>

@if (ViewBag.Message != null && ViewBag.Message != string.Empty)
{
    <div style="float: left;">
        <b>@ViewBag.Message</b>
    </div>
    <br/>
}

<!--start Pagination-->
@if (ViewBag.Pagination != null)
{
    @Html.Partial("~/Egrants/Views/_egrants_showPagination.cshtml")
}
<!--end Pagination-->
<!--start grant layer-->
@if (ViewBag.grantlayer != null && ViewBag.grantlayer.Count > 0)
{
    var grant_id = 0;
    var pi_email = string.Empty;

    <form name="frmDocs">
    @foreach (var grant in ViewBag.grantlayer)
    {
        grant_id = Convert.ToInt32(grant.grant_id);
        var applscount = 0;

        //if (ViewBag.bygrant != null && ViewBag.bygrant == 1)
        if (ViewBag.GrantID != null)
        {
            <!--load all appls-->
            foreach (var appl in ViewBag.appllayer_All)
            {
                if (Convert.ToInt32(appl.grant_id) == grant_id)
                {
                    applscount++;
                }
            }
        }
        else
        {
            foreach (var appl in ViewBag.appllayer)
            {
                if (Convert.ToInt32(appl.grant_id) == grant_id)
                {
                    applscount++;
                }
            }
        }

        <!--start grant layer-->
        <div id="grant_layer_@grant.grant_id" style="display: inline; float: left; padding: 10px 5px 10px 0; width: 900px;">
        <!--padding:10px 5px 10px 20px-->
        <div style="float: left; vertical-align: bottom; width: auto">
            <img style="height: 24px;" src="~/Content/images/Folder-icon.png" title="Grant Folder"/>
            <b style="font-size: medium;">@Convert.ToString(grant.all_activity_code)@Convert.ToString(grant.grant_num)</b>&#0160;&#0160;
            @if (Convert.ToString(grant.former_grant_num) != "")
            {
                <b>Formerly: @grant.former_grant_num</b>
            }
        </div>

        <!--start search bar-->
        <div id="search_bar_@grant.grant_id" style="display: inline; float: right; margin-left: 10px;">

            <a class="btn btn-default" style="background-color: #808080; color: white" id="all_appl" href="javascript:getByAll(@grant.grant_id)" title="View Categories and Grant Years for @grant.grant_num">All</a><span>&#0160;</span>

            <label style="font-size: medium; margin-left: 10px;">
                <strong># of Grant Years</strong>
            </label>
            <input type="text" id="txtYears_@grant.grant_id" name="years_@grant.grant_id" class="form-control" style="display: inline; height: 35px; width: 50px;" placeholder="Yrs" onkeyup="return checkYears(event, @Convert.ToInt32(grant.grant_id))"/> @*onkeyup="if (event.keyCode == 13) return checkYears(@Convert.ToInt32(grant.grant_id))"*@

            @if (ViewBag.SelectedCats != "" && ViewBag.SelectedCats != null)
            {
                <a href="Javascript:show_cats_zone(@grant.grant_id)">
                    <img height="34" src="~/Content/images/filter_selected.png" title="View Category Filter for @grant.grant_num" style="margin-left: 20px;"/>
                </a>
            }
            else
            {
                <a href="Javascript:show_cats_zone(@grant.grant_id)">
                    <img height="40" src="~/Content/images/filter.png" title="View Category Filter for @grant.grant_num" style="margin-left: 20px;"/>
                </a>
            }

            <button type="button" class="btn btn-default" onclick="return getBySelected(@Convert.ToInt32(grant.grant_id))" title="View Selected Years and Categories for @grant.grant_num">
                <img src="~/Content/images/searchicon.png" width="22" height="22"/>
            </button>
        </div>
        <!--end search bar-->
        <!--start show category zone-->
        <div id="cats_zone_@grant.grant_id" class="cats_zone" style="border-bottom: groove; border-color: darkgrey; border-top: groove; display: none; float: left; min-height: 50px; padding-bottom: 5px; padding-left: 20px; width: 900px;">
            <input type="checkbox" id="all_cats_@grant.grant_id" onClick="JavaScript:select_all_cats_zone(@grant.grant_id)"/><span>&#0160;&#0160;</span><b>Select All</b><br/>
            <div id="catlist_@Convert.ToString(grant.grant_id)" style="display: inline; float: left; width: 900px;">
                <div class="row">
                    <div class="col-sm" id="cats_zone_column_1_@Convert.ToString(grant.grant_id)" style="display: inline"></div>
                    <div class="col-sm" id="cats_zone_column_2_@Convert.ToString(grant.grant_id)" style="display: inline"></div>
                    <div class="col-sm" id="cats_zone_column_3_@Convert.ToString(grant.grant_id)" style="display: inline"></div>
                </div>
            </div>
        </div>
        <!--end show category zone-->
        <br/>
        <div id="grant_zone_@grant.grant_id" style="border-bottom: groove; border-color: darkgrey; display: inline; float: left; width: 900px;">
        <!--start grant infor-->
        <div id="grant info_@grant.grant_id" style="display: inline; float: left;">
            <div id="PT infor" style="display: inline">
                <div id="grantbar1" style="float: left">
                    <b>Project Title:</b>
                </div>
                <div id="grantbar2" style="width: 500px;">
                    @if (!string.IsNullOrEmpty(grant.SelectedProjectName))
                    {
                        @grant.SelectedProjectName
                    }
                    else
                    {
                        @grant.project_title
                    }
                </div>
            </div><br/>
            <div id="PI infor" style="display: inline">
                <div id="grantbar1" style="float: left">
                    <b>PI:</b>
                </div>
                <div id="grantbar2" style="width: 500px;">
                    @if (!string.IsNullOrEmpty(grant.SelectedGrantPiName) && !string.IsNullOrEmpty(grant.SelectedGrantPiEmail != ""))
                    {
                        // add the current_bo email to the email 
                        if (!string.IsNullOrEmpty(grant.current_bo_email_address))
                        {
                            pi_email = grant.current_pi_email_address + ";" + grant.current_bo_email_address;
                        }
                        else
                        {
                            pi_email = grant.current_pi_email_address;
                        }

                        if (grant.current_pi_name.ToUpper() == grant.SelectedGrantPiName.ToUpper())
                        {
                            <a href="JavaScript:send_email('@pi_email','@grant.latest_full_grant_num','@grant.current_pi_name')" class="mr-2" title="Send email to @grant.current_pi_name">@grant.current_pi_name</a>
                        }
                        else
                        {
                            <span class="mr-2">@grant.SelectedGrantPiName</span>
                        }
                    }
                    else if (!string.IsNullOrEmpty(grant.SelectedGrantPiName) && string.IsNullOrEmpty(grant.SelectedGrantPiEmail))
                    {
                        <span class="mr-2">@grant.SelectedGrantPiName</span>
                    }
                    else if (!string.IsNullOrEmpty(grant.current_pi_name) && !string.IsNullOrEmpty(grant.current_pi_email_address))
                    {
                        if (grant.current_bo_email_address != "")
                        {
                            pi_email = grant.current_pi_email_address + ";" + grant.current_bo_email_address;
                        }
                        else
                        {
                            pi_email = grant.current_pi_email_address;
                        }

                        if (grant.current_pi_name.ToUpper() == grant.SelectedGrantPiName.ToUpper() || string.IsNullOrEmpty(grant.SelectedGrantPiEmail))
                        {
                            <a href="JavaScript:send_email('@pi_email','@grant.latest_full_grant_num','@grant.current_pi_name')" class="mr-2" title="Send email to @grant.current_pi_name">@grant.current_pi_name</a>
                        }
                        else
                        {
                             <span class="mr-2">@grant.current_pi_name</span>
                        }
                    }
                    else if (!string.IsNullOrEmpty((grant.current_pi_name) && string.IsNullOrEmpty(grant.current_pi_email_address)))
                    {
                        <span class="mr-2">@grant.current_pi_name</span>
                    }

                    @if (!string.IsNullOrEmpty(grant.SelectedOrganizationName))
                    {
                        @grant.SelectedOrganizationName
                                                
                    }
                    else if (grant.org_name != "")
                    {
                        @grant.org_name
                    }
                </div>
            </div><br/>
            @if (!string.IsNullOrWhiteSpace(grant.current_pd_name) || !string.IsNullOrWhiteSpace(grant.current_pd_email_address) || !string.IsNullOrWhiteSpace(grant.prog_class_code))
            {
                <div id="PD infor" style="display: inline">
                    <div id="grantbar1" style="float: left">
                        @if (!string.IsNullOrWhiteSpace(grant.current_pd_name))
                        {
                            <b>Program Director:</b>
                        }
                    </div>
                    <div id="grantbar2" style="width: 500px;">
                        @if (!string.IsNullOrWhiteSpace(grant.current_pd_name) && !string.IsNullOrWhiteSpace(grant.current_pd_email_address))
                        {
                            <a href="JavaScript:send_email('@grant.current_pd_email_address','@grant.latest_full_grant_num','@grant.current_pi_name')" title="Send email to @grant.current_pd_name">@grant.current_pd_name </a>
                            <b>&nbsp;&nbsp;Code:</b>
                            <span>&nbsp;&nbsp;</span>
                            @grant.prog_class_code
                        }
                        else if (!string.IsNullOrWhiteSpace(grant.current_pd_name) && string.IsNullOrWhiteSpace(grant.current_pd_email_address))
                        {
                            @grant.current_pd_name
                            <b> &nbsp; &nbsp; Code:</b>
                            @grant.prog_class_code
                        }
                    </div>
                </div>
                <br/>
            }
            @if (!string.IsNullOrWhiteSpace(grant.current_spec_name) || !string.IsNullOrWhiteSpace(grant.current_spec_email_address))
            {
                <div id="SPEC infor" style="display: inline">
                    <div id="grantbar1" style="float: left">
                        <b> Specialist:</b>
                    </div>
                    <div id="grantbar2" style="width: 500px;">
                        @if (!string.IsNullOrWhiteSpace(grant.current_spec_name) && !string.IsNullOrWhiteSpace(grant.current_spec_email_address))
                        {
                            <a href="JavaScript:send_email('@grant.current_spec_email_address','@grant.latest_full_grant_num','@grant.current_pi_name')" title="Send email to @grant.current_spec_name"> @grant.current_spec_name </a>
                        }
                        else if (!string.IsNullOrWhiteSpace(grant.current_spec_name) && string.IsNullOrWhiteSpace(grant.current_spec_email_address))
                        {
                            @grant.current_spec_name
                        }
                    </div>
                </div>
                <br/>
            }
            @if (ViewBag.GrantID == null && ViewBag.appllayer_All != null)
            {
                <div id="Year info" style="display: inline">
                    <div id="grantbar1" style="float: left">
                        <b> Years:</b>
                    </div>
                    <div id="grantbar2" style="width: 500px;">
                        @Html.Partial("~/Egrants/Views/_egrants_showApplsList.cshtml", grant_id)
                    </div>
                </div>
            }
        </div>
        <!--end grant zone-->
        <!--start show flag zone-->
        <div id="flag_infor_@grant_id" style="display: inline; float: right; height: 80px; width: 250px;">
            <!--show adm supplement requests-->
            @if (Convert.ToInt16(grant.adm_supp) > 0)
            {
                <span style="margin-left: 10px;">
                    <a href="Javascript:show_supplement('@grant.grant_id','to_view')">
                        <b style="vertical-align: bottom;" title="View Supplement Files">Supplement</b>
                    </a>
                </span>
                <br/>
            }
            <!--show grant flags-->
            <div id="flag_zone_@grant_id" style="display: inline; float: right; height: 80px; width: 250px;">
                @if (Convert.ToString(grant.ds_flag) == "y")
                {
                    <span style="margin-left: 10px; width: 80px;">
                        <a href="JavaScript:show_grant_with_flag('DS', @Convert.ToInt32(grant.grant_id))">
                            <img src="~/Content/images/flag_ds.jpg" style="height: 16px; margin-left: 5px" title="View Diversity Supplement Funded Grant for @grant.grant_num"/>
                        </a>
                    </span>
                }

                @if (Convert.ToString(grant.ms_flag) == "y")
                {
                    <span style="margin-left: 10px; width: 80px;">
                        <a href="JavaScript:show_grant_with_flag('MS', @Convert.ToInt32(grant.grant_id))">
                            <img src="~/Content/images/flag_ms.jpg" style="height: 16px; margin-left: 5px" title="View Moonshot Funded Grant for @grant.grant_num"/>
                        </a>
                    </span>
                }

                @if (Convert.ToString(grant.od_flag) == "y")
                {
                    <span style="margin-left: 10px; width: 80px;">
                        <a href="JavaScript:show_grant_with_flag('OD', @Convert.ToInt32(grant.grant_id))">
                            <img src="~/Content/images/flag_od.jpg" style="height: 18px; margin-left: 5px" title="View OD Funded Grant for @grant.grant_num"/>
                        </a>
                    </span>
                }

                @if (Convert.ToString(grant.fda_flag) == "y")
                {
                    <span style="margin-left: 10px; width: 80px;">
                        <a href="JavaScript:show_grant_with_flag('FDA', @Convert.ToInt32(grant.grant_id))">
                            <img src="~/Content/images/flag_fda.jpg" style="height: 16px;" title="View FDA Funded Grant for @grant.grant_num"/>
                        </a>
                    </span>
                }

                @if (Convert.ToString(grant.stop_flag) == "y")
                {
                    <span style="margin-left: 10px; width: 80px;">
                        <a href="#" class="NormalModal" data-toggle="modal" data-target="#NormalModal" data-id="stop" data-assigned-id="@grant.grant_id" title="View Stop Notice for @grant.grant_num">
                            <img src="~/Content/images/flag_stp.png" style="height: 18px; margin-left: 15px"/>
                        </a>
                    </span>
                }

                @if (grant.sv_url != "")
                {
                    <span style="margin-left: 10px; width: 80px;">
                        <a target="_new" href="@Convert.ToString(Session["ImageServer"])@grant.sv_url">
                            <img class="img_18_18" src="~/Content/images/Site_Visit.png" title="View SV Document for @grant.org_name"/>
                        </a>
                    </span>
                }
                @if (grant.institutional_flag1 == true)
                {
                    <span style="margin-left: 10px; width: 80px;">
                        <a href="~/InstitutionalFiles/Show_Docs?org_name=@grant.org_name">
                            <img class="img_18_18" src="~/Content/images/inst_icon_flag.png" title="Follow-Up File Present, View Institutional File(s) for @grant.org_name"/>
                        </a>
                    </span>
                }
                else if (grant.AnyOrgDoc == true)
                {
                    <span style="margin-left: 10px; width: 80px;">
                        <a href="~/InstitutionalFiles/Show_Docs?org_name=@grant.org_name">
                            <img class="img_18_18" src="~/Content/images/inst_icon.png" title="View Institutional File(s) for @grant.org_name"/>
                        </a>
                    </span>
                }
            </div>
            <!--end grant flags-->
        </div>
        <!--end flag zone-->
        </div>
        <!--end grant zone-->
        @*<div style="float:left; padding-bottom:15px; padding-top:15px;"></div>*@
        <!--show appls with documents-->
        @*@if (ViewBag.GrantID != null || ViewBag.ApplID != null || ViewBag.SearchStyle == "by_qc" || (ViewBag.SearchStyle == "by_page" && ViewBag.Str == "qc")){*@
        @*<div id="standardForm">*@
        @if (Convert.ToInt16(ViewBag.DocCount) >= 1)
        {
            // if(CurrentDownloadValue == "Standard")
                        @*<b>@grant_id</b>*@
            <div id="standardForm">
                <div style="float: left; padding-top: 15px;">
                    @Html.Partial("~/Egrants/Views/_egrants_showAppl.cshtml", grant_id)
                </div>
            </div>
            <div hidden id="downloadForm">
                <div style="float: left; padding-top: 15px;">
                    @Html.Partial("~/Egrants/Views/Download/_egrants_showApplDownload.cshtml", grant_id)
                </div>
            </div>
        }
        </div>
        <!--end grant zone-->
        <!--end appl with documents-->
    }
    <!--end grant layer -- if grantlayer is not null-->
    </form>
    <!--end docs form to save all appls and docs-->
}
<!--end ViewBag.grantlayer-->
<!--start Unidentified documents when user run qc-->
@if (ViewBag.UnidentifiedDocs != null && ViewBag.UnidentifiedDocs.Count >= 1)
{
    <div>
        <!--id="UnidentifiedDoc" style="border-top:groove;width:900px; padding:10px 5px 10px 0;"-->
        @Html.Partial("~/Egrants/Views/_egrants_showUnidentifiedDocs.cshtml")
    </div>
}
<!--end show Unidentified documents-->
<!--start show popup modal  style="align-content:center; align-items:center;align-self:center;"-->
<div>
    @Html.Partial("~/Egrants/Views/_egrants_showModal.cshtml")
</div>
<!--end show popup modal-->
</div><!--end main-->